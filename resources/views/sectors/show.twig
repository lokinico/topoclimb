{% extends 'layouts/app.twig' %}

{% block title %}{{ sector.name }} – TopoclimbCH{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block content %}
<div class="sector-page">
    <div class="mb-4 pb-2 border-b">
        <h1 class="text-3xl font-bold text-gray-800">{{ sector.name }}</h1>
        <p class="text-gray-500 text-sm">Secteur situé dans le site <a href="{{ url('/site/' ~ sector.site_id) }}" class="underline">{{ sector.site.name }}</a></p>
    </div>

    {% if media|length > 0 %}
        <div class="mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% if mainImage %}
                    <div class="rounded overflow-hidden shadow">
                        <a href="{{ mainImage }}" class="thumbnail">
                            <img src="{{ mainImage }}" alt="{{ sector.name }}" class="w-full h-auto">
                        </a>
                    </div>
                {% endif %}

                {% if media|length > 1 %}
                    <div id="lightgallery" class="grid grid-cols-3 gap-2">
                        {% for item in media %}
                            {% set fullImage = url('/uploads/' ~ item.file_path) %}
                            {% set thumbImage = url('/uploads/thumbnails/' ~ item.file_path) %}
                            <a href="{{ fullImage }}" class="thumbnail" data-lg-size="1406-1390">
                                <img src="{{ thumbImage }}" alt="Image secteur {{ sector.name }}" class="rounded shadow">
                            </a>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            {% if sector.description %}
                <h2 class="text-xl font-semibold text-gray-700 mb-2">Description</h2>
                <div class="prose max-w-none mb-4">
                    {{ sector.description|raw }}
                </div>
            {% endif %}

            {% if sector.approach %}
                <h2 class="text-xl font-semibold text-gray-700 mb-2">Approche</h2>
                <p class="mb-4">{{ sector.approach }}</p>
            {% endif %}

            {% if sector.access %}
                <h2 class="text-xl font-semibold text-gray-700 mb-2">Accès</h2>
                <p class="mb-4">{{ sector.access }}</p>
            {% endif %}
        </div>

        <div class="bg-gray-100 rounded-lg p-4 shadow-sm">
            <h2 class="text-lg font-semibold text-gray-700 mb-3">Informations techniques</h2>
            <ul class="text-sm text-gray-800 space-y-2">
                {% if sector.altitude %}
                    <li><strong>Altitude :</strong> {{ sector.altitude }} m</li>
                {% endif %}
                {% if sector.orientation %}
                    <li><strong>Orientation :</strong> {{ sector.orientation }}</li>
                {% endif %}
                {% if sector.cotation_min and sector.cotation_max %}
                    <li><strong>Degrés :</strong> {{ sector.cotation_min }} – {{ sector.cotation_max }}</li>
                {% endif %}
                {% if sector.season %}
                    <li><strong>Saison :</strong> {{ sector.season }}</li>
                {% endif %}
                {% if sector.children|length > 0 %}
                    <li><strong>Nombre de voies :</strong> {{ sector.children|length }}</li>
                {% endif %}
            </ul>
        </div>
    </div>

    {% if sector.coordinates_lat and sector.coordinates_lng %}
        <div class="mt-10">
            <h2 class="text-xl font-semibold text-gray-700 mb-2">Localisation</h2>
            <div id="map" class="w-full h-96 rounded shadow"></div>
        </div>
    {% endif %}

    {% if sector.children|length > 0 %}
        <div class="mt-10">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Voies du secteur</h2>
            <ul class="space-y-3">
                {% for route in sector.children %}
                    <li class="border-b pb-2">
                        <span class="font-semibold">{{ route.name }}</span>
                        {% if route.cotation %} – <span class="text-gray-600">{{ route.cotation }}</span>{% endif %}
                        {% if route.length %} ({{ route.length }} m){% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
    {% if sector.coordinates_lat and sector.coordinates_lng %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var map = L.map('map').setView([{{ sector.coordinates_lat }}, {{ sector.coordinates_lng }}], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
            L.marker([{{ sector.coordinates_lat }}, {{ sector.coordinates_lng }}]).addTo(map)
                .bindPopup('{{ sector.name }}')
                .openPopup();
        });
    </script>
    {% endif %}
{% endblock %}
